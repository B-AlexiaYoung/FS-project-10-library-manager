extends layout.pug
block content 
    
    body
        h1  #{title}
        //- const singleBook = bookinfo
        form( action="/books/update/" + `${bkloan.id}` + "?_method=PUT" method="post")  
            label(for="title") Book Title
            input(id="title" name= "title" type="text" value = `${bkloan.title}` required) 
            p
                label(for="author") Author
                a(href="/patrons/" + `${bkloan.id}`)
                    input(id= "author" name ="author" type="text" value = `${bkloan.author}` required) 
            p     
                label(for="genre") Genre
                input(id = "genre" name="genre" type="text" value =`${bkloan.genre}` required)  
            p   
                label(for="first_published") First Published
                input(id="first_published" name="first_published" type="number" value=`${bkloan.first_published}`  )

            input(type="submit" value="Update")

        h2 Loan History
        table
            thead
                tr
                    th Book
                    th Patron 
                    th Loaned on
                    th Return by 
                    th Returned on                
                    th Action
            tbody
            



                tr
                td
                    a(href="#") #{bkloan.title}   
                - const getfromloans = bkloan.dataValues.loans
                
                //- console.log(getfromloans)
                each getfrom, index in getfromloans
                    //- fullName = getfrom.dataValues.patrons.dataValues.first_name
                    - let fullName = getfrom.dataValues.patron.dataValues.first_name + " " + getfrom.dataValues.patron.dataValues.last_name
                    - let loanedOn = getfrom.dataValues.loaned_on
                    - let returnBy = getfrom.dataValues.return_by
                    - let returnedOn = getfrom.dataValues.returned_on

                    td  
                        a(href="patrons/patron_details/"+ `${getfrom.dataValues.patron.dataValues.library_id}` ) #{fullName}
                    td  #{moment(loanedOn).format("YYYY-MM-DD")} 
                    td  #{moment(returnBy).format("YYYY-MM-DD")}
                    if returned = null
                        td  |
                    else 
                        td #{moment(returnedOn).format("YYYY-MM-DD")}

                td 
                    a(href="return/returned"+ getfromloans.id class="button") Return Book
